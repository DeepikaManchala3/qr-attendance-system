{% extends "base.html" %}
{% block title %}Hostel Entry/Exit{% endblock %}
{% block content %}
<div class="grid grid-2">
  <div class="card">
    <h2>Gate Logging</h2>
    <div style="display:flex; gap:8px; margin-bottom:8px;">
      <input id="gate" class="input" value="Main Gate">
      <button class="btn" onclick="setHostelMode('ENTRY')">ENTRY</button>
      <button class="btn secondary" onclick="setHostelMode('EXIT')">EXIT</button>
      <button class="btn" onclick="setHostelMode('TOGGLE')">TOGGLE</button>
    </div>

    <div id="reader" style="width:100%;"></div>

    <p id="hMode" class="muted">Mode: TOGGLE</p>
    <p id="hostelMsg" class="muted"></p>


     <!-- Status icons -->
    <div id="statusBox" style="margin-top:10px;">
      <span id="qrStatus" class="muted">QR ❌</span> | 
      <span id="faceStatus" class="muted">Face ❌</span>
    </div>


    <div>
      <input id="manual" class="input" placeholder="Paste STUDENT:STU1001 or STU1001">
      <button class="btn" onclick="manualHostel()">Log</button>
    </div>

    <div id="faceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded shadow-lg w-[400px]">
    <h3 class="text-lg font-bold mb-2">Face Verification</h3>
    <video id="faceCamera" autoplay class="w-full border mb-2"></video>
    <div style="display:flex; gap:8px; margin-top:8px;">
      <button class="btn" onclick="startFaceVerify()">Verify Face</button>
      <button class="btn bad" onclick="stopFaceWithPassword()">Stop Face (Operator)</button>
    </div>
    <p id="faceVerifyMsg" class="muted mt-2"></p>

   </div>
  </div>
  </div>
  <div class="card">
    <h2>Recent Hostel Logs</h2>
    <table class="table">
      <thead><tr><th>Time</th><th>Student</th><th>Action</th><th>Gate</th></tr></thead>
      <tbody>
        {% for r in recent %}
          <tr>
            <td>{{ r.ts.strftime("%Y-%m-%d %H:%M") }}</td>
            <td>{{ r.student_sid }}</td>
            <td>{{ r.action }}</td>
            <td>{{ r.gate }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  
</div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script src="{{ url_for('static', filename='js/hostel.js') }}"></script>
{% endblock %}
